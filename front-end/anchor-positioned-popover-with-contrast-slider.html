<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Anchor Positioned Popover with Contrast Slider</title>

    <link href="https://fonts.bunny.net/css?family=amaranth:400,400i,700,700i|asap-condensed:200,300i,400,400i,600,700,900|m-plus-1-code:400,500,600,700"
          rel="stylesheet">
    <link href="https://fonts.bunny.net/css?family=amaranth:400,400i,700,700i|asap-condensed:200,300i,400,400i,600,600i,700,700i,900,900i|asap:200,300i,400,400i,600,600i,700,700i,900,900i|kode-mono:400,500,600,700|fredoka:400,500"
          rel="stylesheet">

    <style>
        @import url(https://fonts.bunny.net/css?family=amaranth:400,400i,700,700i|asap-condensed:200,300i,400,400i,600,700,900|m-plus-1-code:400,500,600,700);

        :root {
            --h: 222;
            --s: 20%;
            --l: 22%;

            --canvas: var(--h);
            --bg: hsl(var(--canvas), 15%, 22%);
            --fg: hsl(var(--canvas), 39%, 95%);
            --link-light: hsl(var(--canvas), 95%, 60%);
            --link-dark: hsl(var(--canvas), 95%, 70%);
            --link-light-hover: hsl(150, 80%, 45%);
            --link-dark-hover: hsl(150, 95%, 70%);
            --link: light-dark(var(--link-light), var(--link-dark));
            --linkh: light-dark(var(--link-light-hover), var(--link-dark-hover));
            --wgt: 200;

            --light: hsl(var(--h), var(--s), 95%);
            --dark: hsl(var(--h), var(--s), 20%);
            --tint: hsl(160, 85%, 60%);
            --tint2: hsl(200, 85%, 60%);
            --pads: 16px;
            --cols: 1fr;
            --radius: 16px;

            --bor: hsl(var(--h), var(--s), 85%);
            --labels: hsl(var(--h), var(--s), 55%);
            --b: hsla(var(--h), var(--s), 100%, 1);
            --svg: var(--fg);

            --thumb-shadow: 0px 1px 0px rgba(17, 17, 26, 0),
            0px 2px 2px rgba(17, 17, 26, 0),
            0px 4px 4px rgba(17, 17, 26, 0);

            --thumb-shadow-on: 0px 1px 0px rgba(17, 17, 26, 0.2),
            0px 2px 6px rgba(17, 17, 26, 0.2),
            0px 4px 12px rgba(17, 17, 26, 0.2);

            --spring: linear(
                    0, 0.009, 0.035 2.1%, 0.142 4.6%, 0.283 6.9%, 0.726 13.3%, 0.941 17.2%, 1.02,
                    1.08, 1.124, 1.153 24.9%, 1.163, 1.167, 1.165, 1.157 30.7%, 1.132 33.7%,
                    1.051 40.7%, 1.017 44.2%, 0.99, 0.975 52.2%, 0.972 55.2%, 0.974 58.5%,
                    0.996 71.5%, 1.003, 1.005 85.7%, 1
            );

            --bounce: linear(0, 0.199 14.6%, 0.37 23.8%, 0.591 32.2%, 0.999 44.7%, 0.793 52.7%,
            0.745 56.1%, 0.728 59.5%, 0.74 62.5%, 0.778 65.7%, 0.999 77.4%, 0.956 81.3%, 0.943 84.9%, 0.951 88%, 0.993 95.5%, 1);

        }

        #app {
            display: grid;
            grid-template-columns: var(--cols);
            gap: var(--pads);
            min-height: 100%;
        }

        body {
            padding: calc(var(--pads) * 1.5);
            font-family: 'Asap Condensed', sans-serif;
            font-weight: 400;
            font-size: 1rem;
            color: var(--fg);
            background-color: #171820;
            background-image: linear-gradient(
                    180deg,
                    hsl(var(--h), var(--s), 8%),
                    hsl(var(--h), var(--s), 14%)
            );
            background-size: cover;
        }

        body,
        html {
            min-height: 100%;
        }

        * {
            box-sizing: border-box;
        }

        form,
        .form,
        .light {
            --bg: var(--light);
            --fg: var(--dark);
        }

        form,
        .form {
            color: var(--fg);
            background-color: var(--bg);
            min-width: 100%;
            width: 100%;
            padding: calc(var(--pads) * 0.5) calc(var(--pads) * 1.5) calc(var(--pads) * 1);
            border-radius: var(--radius);
            box-shadow: 0 2px 3px hsla(var(--h), var(--s), 8%, 50%);
        }

        .dark {

            color-scheme: dark !important;

            --bor: hsl(var(--h), var(--s), 35%);
            --bg: var(--dark);
            --fg: var(--light);
            --labels: hsl(var(--h), var(--s), 65%);
            --b: hsla(var(--h), var(--s), 12%, 1);
            --tint: hsl(260, 85%, 60%);
            --tint2: hsl(300, 85%, 60%);
        }

        fieldset {
            min-width: 100%;
            width: 100%;
            border: 1px solid var(--bor);
            border-radius: calc(var(--radius) / 2);
            padding: var(--pads) calc(var(--pads) * 1.5);
            margin-block: var(--pads);
        }

        legend {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 2em;
            transform: translateX(-1em);
        }

        label {
            display: block;
            width: -webkit-max-content;
            width: -moz-max-content;
            width: max-content;
            font-size: 0.875rem;
            text-transform: uppercase;
            -webkit-margin-start: 0;
            margin-inline-start: 0;
            -webkit-margin-after: 0.5em;
            margin-block-end: 0.5em;
            color: var(--labels);
            transition: all 0.5s ease;
        }

        .field:focus-within label {
            color: var(--fg);
        }

        .field {
            margin-block: 2.5em;
            container-type: inline-size;
        }

        .field:nth-of-type(1) {
            -webkit-margin-before: 1em;
            margin-block-start: 1em;
        }

        .field:nth-last-of-type(1) {
            -webkit-margin-after: 1em;
            margin-block-end: 1em;
        }

        input,
        select,
        button,
        textarea {
            font-family: inherit;
            color: var(--fg);
            background: var(--b);
            padding: 0.875em;
            border-radius: calc(var(--radius) / 2);
            border: 1px solid transparent;
            outline: 1px solid transparent;
            accent-color: var(--tint2);
            box-shadow: 0 3px 2px -3px var(--bor);
            transition: border 0.3s ease-in, outline 0.6s ease-in, box-shadow 0.6s ease-in;
        }

        input,
        select,
        textarea {
            width: clamp(50%, 20em, 100%);
        }

        input:focus,
        select:focus,
        button:focus,
        textarea:focus {
            border-color: var(--tint);
            outline-color: var(--tint2);
            transition: border 0.6s ease-out, outline 0.3s ease-out,
            box-shadow 0.3s ease-out;
        }

        input::-moz-placeholder,
        select::-moz-placeholder,
        button::-moz-placeholder,
        textarea::-moz-placeholder {
            opacity: 0.33;
            font-style: italic;
        }

        input:-ms-input-placeholder,
        select:-ms-input-placeholder,
        button:-ms-input-placeholder,
        textarea:-ms-input-placeholder {
            opacity: 0.33;
            font-style: italic;
        }

        input::placeholder,
        select::placeholder,
        button::placeholder,
        textarea::placeholder {
            opacity: 0.33;
            font-style: italic;
        }

        textarea {
            width: 100%;
            min-height: 10em;
            resize: vertical;
            display: block;
        }

        select {
            appearance: none;
            background-image: url('data:image/svg+xml; utf8, <svg width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.2929,5.292875 C12.6834,4.902375 13.3166,4.902375 13.7071,5.292875 C14.0976,5.683375 14.0976,6.316555 13.7071,6.707085 L8.70711,11.707085 C8.31658,12.097605 7.68342,12.097605 7.29289,11.707085 L2.29289,6.707085 C1.90237,6.316555 1.90237,5.683375 2.29289,5.292875 C2.68342,4.902375 3.31658,4.902375 3.70711,5.292875 L8,9.585765 L12.2929,5.292875 Z"  style="fill: hsl(222,20%,40%);"/></svg>');
            background-size: 1em;
            background-position: calc(100% - 1em) 50%;
            background-repeat: no-repeat;
        }

        .dark select {
            background-image: url('data:image/svg+xml; utf8, <svg width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.2929,5.292875 C12.6834,4.902375 13.3166,4.902375 13.7071,5.292875 C14.0976,5.683375 14.0976,6.316555 13.7071,6.707085 L8.70711,11.707085 C8.31658,12.097605 7.68342,12.097605 7.29289,11.707085 L2.29289,6.707085 C1.90237,6.316555 1.90237,5.683375 2.29289,5.292875 C2.68342,4.902375 3.31658,4.902375 3.70711,5.292875 L8,9.585765 L12.2929,5.292875 Z"  style="fill: hsl(222,20%,70%);"/></svg>');
        }

        input[type="radio"],
        input[type="checkbox"] {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            width: calc(1em + 8px);
            height: calc(1em + 8px);
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 100%;
        }

        input[type="radio"],
        input[type="radio"]:after,
        input[type="checkbox"] {
            transition: all 0.4s ease-in;
            background-clip: padding-box;
        }

        input[type="radio"]:focus,
        input[type="radio"]:focus:after,
        input[type="checkbox"]:focus {
            transition: all 0.3s ease-out, scale 0.5s var(--spring);
        }

        input[type="radio"]:after,
        input[type="checkbox"]:after {
            content: "";
            width: calc(100% - 8px);
            height: calc(100% - 8px);
            background: transparent;
            border-radius: 100%;
            opacity: 0.9;
            scale: 0.2;
        }

        input[type="radio"]:checked:after,
        input[type="checkbox"]:checked:after {
            background: var(--fg);
            scale: 1;
        }

        input[type="radio"]:focus,
        input[type="checkbox"]:focus {
            background-color: var(--tint);
            background-image: linear-gradient(to bottom right, transparent, var(--tint2) 150%);
        }

        input[type="radio"]:focus:after,
        input[type="checkbox"]:focus:after {
            opacity: 1;
        }

        input[type="radio"] + label,
        input[type="checkbox"] + label,
        label:has( + input[type="checkbox"].toggle.dual ) {
            text-transform: none;
            display: inline-flex;
            align-items: center;
            padding: 0 0.25em;
            user-select: none;
            transition: color 0.25s ease-out;
        }

        input[type="radio"]:checked + label,
        input[type="checkbox"]:checked + label,
        label:has( + input[type="checkbox"]:not(:checked).toggle.dual ) {
            font-weight: 600;
            color: var(--fg);
        }

        input[type="radio"] + label svg,
        input[type="checkbox"] + label svg,
        label:has( + input[type="checkbox"].toggle.dual ) svg {
            height: 20px;
            stroke-width: 1.5px;
            stroke: currentColor;
        }

        input[type="radio"]:checked + label svg,
        input[type="checkbox"]:checked + label svg,
        label:has( + input[type="checkbox"]:not(:checked).toggle.dual ) svg {
            stroke-width: 2px;
        }

        input[type="radio"],
        input[type="checkbox"],
        input[type="radio"] + label,
        input[type="checkbox"] + label,
        label:has( + input[type="checkbox"].toggle.dual ) {
            &:hover {
                color: var(--fg);

                + label {
                    color: var(--fg);
                }
            }
        }

        input[type="checkbox"] {
            border-radius: 5px;
        }

        input[type="checkbox"]:after,
        input[type="checkbox"]:focus:after {
            opacity: 0;
            translate: 0% -100%;
            scale: 1;
        }

        input[type="checkbox"]:after {
            transition: opacity 0.2s ease-in, translate 0.4s ease-in;
        }

        input[type="checkbox"]:checked:after {
            opacity: 1;
            translate: 0% 0%;
            transition: opacity 0.15s ease-out 0.1s, translate 0.4s var(--bounce);
        }

        input[type="checkbox"]:after,
        input[type="checkbox"]:checked:after {
            background-color: transparent;
            background-image: url('data:image/svg+xml; utf8, <svg width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M13.7071,4.29289 C14.0976,4.68342 14.0976,5.31658 13.7071,5.70711 L7.70711,11.7071 C7.31658,12.0976 6.68342,12.0976 6.29289,11.7071 L3.29289,8.70711 C2.90237,8.31658 2.90237,7.68342 3.29289,7.29289 C3.68342,6.90237 4.31658,6.90237 4.70711,7.29289 L7,9.58579 L12.2929,4.29289 C12.6834,3.90237 13.3166,3.90237 13.7071,4.29289 Z"  style="fill: hsl(222,20%,40%);"/></svg>');
            background-size: 1.2em;
            background-position: center;
        }

        .dark input[type="checkbox"]:after,
        .dark input[type="checkbox"]:checked:after {
            background-image: url('data:image/svg+xml; utf8, <svg width="16px" height="16px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M13.7071,4.29289 C14.0976,4.68342 14.0976,5.31658 13.7071,5.70711 L7.70711,11.7071 C7.31658,12.0976 6.68342,12.0976 6.29289,11.7071 L3.29289,8.70711 C2.90237,8.31658 2.90237,7.68342 3.29289,7.29289 C3.68342,6.90237 4.31658,6.90237 4.70711,7.29289 L7,9.58579 L12.2929,4.29289 C12.6834,3.90237 13.3166,3.90237 13.7071,4.29289 Z"  style="fill: hsl(222,20%,95%);"/></svg>');
        }

        input[type="checkbox"].toggle {
            --aspect: 1.75;
            --ratio: var(--aspect)/1;
            --gap: 3px;

            cursor: pointer;
            text-indent: -9999px;
            width: auto;
            height: calc(1em + var(--gap) * 4);
            aspect-ratio: var(--ratio);
            display: block;
            border-radius: calc(1em + var(--gap) * 4);
            position: relative;
            padding: 0;
            background: var(--b);
        }

        input[type="checkbox"].toggle:after {
            content: "";
            width: auto;
            height: calc(100% - var(--gap) * 2);
            aspect-ratio: 1;
            border-radius: 100%;
            position: absolute;
            inset: 0;
            right: auto;
            background: var(--fg);
            translate: var(--gap) var(--gap);
            transition: translate 0.5s var(--spring), scale 0.5s var(--spring), aspect-ratio 0.5s var(--spring);
            opacity: 0.9;
            scale: 0.8 0.8;
            transform-origin: left center;
            will-change: transform, translate, scale;
        }

        input[type="checkbox"].toggle.dual:after {
            scale: 1 1;
        }

        input[type="checkbox"].toggle:active {
            &:after {
                scale: 1.15 1;
            }

            &:checked:after {
                scale: 1.2 1;
                transform-origin: right center;
            }
        }

        input[type=checkbox].toggle:where(:not(:checked)) {
            background: color-mix(in hsl, transparent, var(--b) 50%);
        }

        input[type=checkbox].toggle:where(:not(:checked):hover) {
            background: var(--b);
        }

        input[type=checkbox].toggle:focus {
            background: color-mix(in hsl, var(--tint), var(--bg) 80%);
        }

        input[type=checkbox].toggle:checked:focus,
        input[type=checkbox].toggle.dual:focus {
            background: var(--tint);
        }

        input[type=checkbox].toggle.dual:checked:focus {
            background: var(--tint2);
            border-color: var(--tint2);
        }

        input[type=checkbox].toggle:checked:after {
            translate: calc((1em + var(--gap) * 4) * var(--aspect) - (100% + var(--gap) + 1px)) var(--gap);
            opacity: 1;
            scale: 1;
        }

        .range {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-block: 1em;
        }

        .range label {
            margin: 0;
            min-width: -webkit-max-content;
            min-width: -moz-max-content;
            min-width: max-content;
            text-transform: none;
            font-size: 0.75em;
        }

        .range:first-child {
            text-align: right;
        }

        .range:last-child {
            text-align: left;
        }

        input[type="range"] {
            --pad: calc(var(--pads) / 4);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: calc(100% - 1em);
            height: calc(1em + var(--pad) * 2);
            background: var(--b);
            border: none;
            outline: none;
            padding: 0 var(--pad);
            border-radius: 1em;

            &:not(:first-child) {
                margin-inline-start: 0.5em;
            }

            &:not(:last-child) {
                margin-inline-end: 0.5em;
            }
        }

        input[type="range"],
        input[type="range"] * {
            transition: all 0.5s ease;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            background: linear-gradient(90deg, var(--tint) -25%, var(--tint2) 125%);
            display: block;
            width: calc(100% + var(--pad) * 2);
            height: calc(1em + var(--pad) * 2);
            border-radius: 1em;
            margin-inline: calc(var(--pad) * -1);
            -webkit-transition: opacity 0.5s ease-in, background 0.5s ease-in;
            transition: opacity 0.5s ease-in, background 0.5s ease-in;
            opacity: 0;
            will-change: opacity, background;
            background: var(--b);
            padding: 0.25em var(--pad);
            opacity: 1;
        }

        input[type="range"]::-moz-range-track {
            background: linear-gradient(90deg, var(--tint) -25%, var(--tint2) 125%);
            display: block;
            width: calc(100% + var(--pad) * 2);
            height: calc(1em + var(--pad) * 2);
            border-radius: 1em;
            margin-inline: calc(var(--pad) * -1);
            -moz-transition: opacity 0.5s ease-in, background 0.5s ease-in;
            transition: opacity 0.5s ease-in, background 0.5s ease-in;
            opacity: 0;
            will-change: opacity, background;
        }

        input[type="range"]::-ms-track {
            background: linear-gradient(90deg, var(--tint) -25%, var(--tint2) 125%);
            display: block;
            width: calc(100% + var(--pad) * 2);
            height: calc(1em + var(--pad) * 2);
            border-radius: 1em;
            margin-inline: calc(var(--pad) * -1);
            -ms-transition: opacity 0.5s ease-in, background 0.5s ease-in;
            transition: opacity 0.5s ease-in, background 0.5s ease-in;
            opacity: 0;
            will-change: opacity, background;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1em;
            height: 1em;
            border: none;
            outline: none;
            background: var(--fg);
            border-radius: 1em;
            transform: translate3d(0, 0, 0);
            transition: 0.5s all var(--spring);
            box-shadow: var(--thumb-shadow);
        }

        input[type="range"]:hover::-webkit-slider-thumb {
            scale: 1.33;
            transition: 0.2s all ease;
        }

        input[type="range"]:focus::-webkit-slider-thumb {
            scale: 2;
            transition: 0.33s all var(--spring);
            box-shadow: var(--thumb-shadow-on);
        }

        input[type="range"]::-moz-range-thumb {
            -moz-appearance: none;
            appearance: none;
            width: 1em;
            height: 1em;
            border: none;
            outline: none;
            background: var(--fg);
            border-radius: 1em;
            transform: translate3d(0, 0, 0);
            transition: 0.5s all var(--spring);
            box-shadow: var(--thumb-shadow);
        }

        input[type="range"]:hover::-moz-range-thumb {
            scale: 1.33;
            transition: 0.2s all ease;
        }

        input[type="range"]:focus::-moz-range-thumb {
            scale: 2;
            transition: 0.33s all var(--spring);
            box-shadow: var(--thumb-shadow-on);
        }


        input[type="range"]::-ms-thumb {
            appearance: none;
            width: 1em;
            height: 1em;
            border: none;
            outline: none;
            background: var(--fg);
            border-radius: 1em;
            transform: translate3d(0, 0, 0);
            transition: 0.5s all var(--spring);
            box-shadow: var(--thumb-shadow);
        }

        input[type="range"]:hover::-ms-thumb {
            scale: 1.33;
            transition: 0.2s all ease;
        }

        input[type="range"]:focus::-ms-thumb {
            scale: 2;
            transition: 0.33s all var(--spring);
            box-shadow: var(--thumb-shadow-on);
        }

        input[type="range"]:focus::-webkit-slider-runnable-track {
            -webkit-transition: background 0.5s ease-out;
            transition: background 0.5s ease-out;
            background: linear-gradient(90deg, var(--tint) -25%, var(--tint2) 125%);
            opacity: 1;
        }

        input[type="range"]:focus::-moz-range-track {
            -moz-transition: opacity 0.5s ease-out;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        input[type="range"]:focus::-ms-track {
            -ms-transition: opacity 0.5s ease-out;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        input[type="color"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            max-width: 4em;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 2.5em;
            padding: 5px;
            border-radius: 10em;
        }

        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: inherit;
            display: block;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
            border-radius: inherit;
        }

        input[type="color"]::-moz-color-swatch {
            border: none;
            border-radius: inherit;
            display: block;
        }

        input[type="color"]::-moz-color-swatch-wrapper {
            padding: 0;
            border-radius: inherit;
        }

        .buttons {
            display: flex;
            justify-content: flex-end;
            gap: 0.5em;
        }

        button {
            display: flex;
            align-items: center;
            gap: 0.5em;
            background: hsl(var(--h), var(--s), 90%);
            text-transform: uppercase;
            padding-inline: 2em;
            box-shadow: inset 0 0 0 1px transparent;
            transition: all 0.3s ease;
        }

        .dark button {
            background: hsl(var(--h), var(--s), 15%);
        }

        button:hover {
            opacity: 0.8;
            box-shadow: inset 0 0 0 1px var(--fg);
        }

        button[type="submit"] {
            --svg: var(--bg);
            background: var(--fg);
            color: var(--bg);
            font-weight: 600;
        }

        button svg {
            fill: var(--svg);
            height: 1em;
            width: auto;
        }

        .group {
            display: grid;
            grid-template-columns: repeat(var(--group-cols, 1), auto 1fr);
            align-items: center;
            margin-block: 0;
            width: max-content;
        }

        .group.flex {
            display: flex;
            align-items: center;
        }

        .group:has(.toggle.dual) {
            grid-template-columns: max-content auto max-content;
        }

        .group input + label,
        .group:has( input[type="checkbox"].toggle.dual ) label {
            display: inline-flex;
            gap: 0.5em;
            padding: 0.5em 0.66em;
            margin-block: 0;
            margin-inline-end: 2em;
        }

        .group:has( input[type="checkbox"].toggle.dual ) label {
            margin-inline: 0;
        }

        @container (width > 300px) {
            .group {
                --group-cols: 2;
            }
        }

        @container (width > 600px) {
            .group {
                --group-cols: 4;
            }
        }


        /* general style */

        a {
            color: var(--link);
            text-decoration: none;
            font-weight: 450;
            transition: all 0.3s ease;
        }

        a:hover,
        a:focus,
        a:active {
            color: var(--linkh);
        }

        h1, h2 {
            font-family: 'Amaranth', sans-serif;
            text-shadow: 0 0.5px 1.5px color-mix(in oklch, var(--fg), var(--bg) 66%);
        }

        h2 {
            font-weight: 200;
            font-style: italic;
            color: color-mix(in oklch, var(--fg) 60%, var(--bg));
        }

        h1 span {
            font-style: italic;
            color: color-mix(in oklch, var(--fg) 60%, var(--bg));
        }

        code, pre {
            font-family: 'M PLUS 1 Code', monospace;
        }

        code {
            display: inline-block;
            padding-inline: 0.4em;
            border-radius: 0.2em;
            background: light-dark(hsl(from var(--fg) h 25% 85% / 50%), hsl(from var(--fg) h 25% 15% / 50%));
            color: color-mix(in oklch, var(--fg), hsl(from var(--tint) h 100% 50%) 50%);
            font-size: 0.875em;
        }

        hr {
            background: none;
            border: none;
            border-bottom: 1px solid var(--bor);
            margin-block: 1em;
        }


        /* https://gist.github.com/ffoodd/000b59f431e3e64e4ce1a24d5bb36034 */

        .sr-only,
        .sr-only-focusable:not(:focus, :focus-within) {
            border: 0 !important;
            clip-path: inset(50%) !important; /* 2 */
            height: 1px !important;
            margin: -1px !important;
            overflow: hidden !important;
            padding: 0 !important;
            width: 1px !important;
            white-space: nowrap !important; /* 3 */
        }

        .sr-only:not(caption),
        .sr-only-focusable:not(caption):not(:focus, :focus-within) {
            position: absolute !important;
        }

        .sr-only *,
        .sr-only-focusable:not(:focus, :focus-within) * {
            overflow: hidden !important;
        }


        /* social */

        .social-icon {
            stroke-width: 1.25;
            stroke: currentColor;
            fill: transparent;
            background: transparent;
            stroke-linecap: round;
            stroke-linejoin: round;
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            z-index: 10;
            animation: iconsLoad 10s ease both 5s;
        }

        .social-icon path {
            fill: none;
        }

        .social-icon.twitter {
            right: 40px;
            animation-delay: 4s;
        }

        .social-icon.codepen {
            bottom: 10px;
            right: 80px;
            width: max-content;
            animation-delay: 3s;
        }

        @keyframes iconsLoad {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0px);
            }
        }


        /* theme-toggle */

        :root {
            color-scheme: light dark;
        }

        :root:has(body.themed):not(:has(#theme-toggle:checked)) {
            color-scheme: light;
        }

        :root:has(body.themed):has(#theme-toggle:checked) {
            color-scheme: dark;
        }

        .theme-toggle {
            position: fixed;
            top: 1em;
            left: 0;
            transition: scale 0.2s var(--cubic), opacity 0.2s var(--cubic);

            &:not(:hover, :focus-within) {
                scale: 0.66;
                opacity: 0.5;
            }

            & > input {
                margin: 0.2em;
            }
        }
    </style>

    <style>
        :root {
            /* vars */
            color-scheme: light !important;
            --shadow-color: var(--fg);
            --active-color: #3880f6;
        }


        button[popovertarget] {

            anchor-name: --anchor-contrast;
            --outline-color: #e8e8e8;

            border-radius: 100vw;
            background: white;
            border: none;
            outline: none;
            box-shadow: inset 0 0 0 1px #ddd,
            0 1px 1px -1px #aaa,
            0 0 0 4px var(--outline-color),
            0 0 50px 10px hsl(from var(--bg) h s 100%),
            0 0 70px 50px hsl(from var(--bg) h s 98%),
            0 0 100px 75px hsl(from var(--bg) h s 96%);

            padding: 0.66em 1.33em;
            margin: clamp(3em, 30vh, 30em) 0 auto;
            transition: box-shadow 0.15s var(--cubic-out);

            &:focus-visible {
                --outline-color: var(--active-color);
            }

            & svg {
                height: 30px;
                scale: -1 1;
                transition: translate 0.15s var(--cubic-out);
                transform: translate3d(0, 0, 0.01px);
            }

            &:has(+ :popover-open) {
                background: hsl(from var(--bg) h s 94%);
                box-shadow: inset 0 0 0 1px #ddd,
                inset 0 1px 2px -1px hsl(from var(--bg) h s 50% / 50%),
                0 0 0 4px #e8e8e8,
                0 0 50px 10px hsl(from var(--bg) h s 100%),
                0 0 70px 50px hsl(from var(--bg) h s 98%),
                0 0 100px 75px hsl(from var(--bg) h s 96%);

                & svg {
                    translate: 0 1px;
                }
            }
        }

        #contrast-popover {

            transition: opacity 0.2s,
            translate 0.2s,
            overlay 0.2s allow-discrete,
            display 0.2s allow-discrete;
            transition-timing-function: var(--cubic-out);

            opacity: 0;
            translate: 10px -60%;
            @supports (position-anchor: --anchor-contrast) {
                position-anchor: --anchor-contrast;
                top: anchor(--anchor-contrast center);
                left: anchor(--anchor-contrast right);
                translate: 10px -60%;
            }
            @supports not (position-anchor: --anchor-contrast) {
                left: calc(50% + 55px);
                top: calc(clamp(3em, 30vh, 30em) + 50px);
            }

            &:popover-open {
                display: flex;
                opacity: 1;
                transition-duration: 0.5s;
                transition-timing-function: var(--spring);
                translate: 10px -50%;
            }

            gap: 16px;
            border: 1px solid var(--bor);
            border-radius: 2em;
            padding: 2px 1em;
            margin: 0;
            overflow: hidden;

            background: bar(--bg);
            box-shadow: hsl(from var(--shadow-color) h s l / 0.01) 0px 1px 1px -0.5px,
            hsl(from var(--shadow-color) h s l / 0.02) 0px 2px 2px -1px,
            hsl(from var(--shadow-color) h s l / 0.02) 0px 3px 3px -1.5px,
            hsl(from var(--shadow-color) h s l / 0.01) 0px 5px 5px -2.5px;
        }

        @starting-style {
            #contrast-popover {
                &:popover-open {
                    opacity: 0;
                    translate: 10px -60%;
                }
            }
        }

        #contrast-slider {

            --pip-height: 7px;
            --slider-width: 70px;

            --range-slider: transparent;
            --range-handle-focus: var(--active-color);
            --range-pip: #f1f1f1;
            --range-pip-active: var(--active-color);
            --range-pip-hover: #ccc;

            margin: 0;
            padding: 0;

            .rangeSlider {
                min-height: 200px;
                width: var(--slider-width);
                margin: 0;
                display: block;
            }

            .rangeHandle {
                width: var(--slider-width);
                height: var(--pip-height);
                left: 50%;
                border-radius: 99vw;
                opacity: 0;
            }

            .rangePips.rsVertical {
                left: 0;
                width: 100%;
            }

            .rangePips .rsPip {

                --pip-shadow: hsl(0 0% 50% / 20%);

                width: 50%;
                left: 50%;
                height: var(--pip-height);
                border-radius: var(--pip-height);
                translate: -50% calc(var(--pip-height) / 2);
                box-shadow: 0 1px 0px 0.5px var(--pip-shadow);

            }

            .rangePips .rsPip {

                --pip-height: 6px;
                width: calc(var(--slider-width) - 30px);

                &:has(+ .rsSelected),
                &.rsSelected + * {
                    width: calc(var(--slider-width) - 20px);
                    --pip-height: 7px;
                }

                &.rsSelected {
                    --pip-height: 8px;
                    height: var(--pip-height);
                    width: var(--slider-width);
                }

                &:hover {
                    --pip-shadow: hsl(0 0% 50% / 50%);
                }

            }

        }


        #contrast-popover {

            .contrast-buttons {
                display: flex;
                gap: 12px;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .contrast-buttons button {

                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                border-radius: 100vw;
                width: 30px;
                aspect-ratio: 1;
                background: #e9e9e9;
                border: none;
                outline: none;
                box-shadow: inset 0 0 0 1px hsl(0 0% 0% / 0.1),
                inset 0 2px 0.5px -0.5px hsl(0 0% 100% / 1),
                inset 0 -2px 0.5px -0.5px hsl(0 0% 0% / 0.05),
                0 2px 2px -0.5px hsl(0 0% 80% / 0.5);

            }

            .contrast-buttons button svg {
                height: 14px;
                width: auto;
            }

            .contrast-buttons span {
                font-family: fredoka;
                font-size: 26px;
                font-weight: 500;
                letter-spacing: 0.02em;
                padding: 0;
                width: 32px;
            }

        }


        :root {

            color-scheme: light dark;

            --bg-light: hsl(220, 16%, 94%);
            --bg-light2: hsl(212, 50%, 92%);
            --bg-dark: hsl(222, 16%, 16%);
            --bg-dark2: hsl(222, 20%, 18%);
            --fg-light: hsl(212 22% 26%);
            --fg-dark: hsl(222, 39%, 95%);
            --link-light: hsl(222, 95%, 60%);
            --link-dark: hsl(222, 95%, 70%);
            --link-light-hover: hsl(150, 80%, 40%);
            --link-dark-hover: hsl(150, 95%, 70%);
            --input-bg-light: hsl(from var(--bg-light) h 15% 100%);
            --input-bg-dark: hsl(from var(--bg-dark) h 15% 10%);
            --input-border-light: hsl(from var(--bg-light) h 15% 85%);
            --input-border-dark: hsl(from var(--bg-light) h 15% 35%);
            --labels-light: hsl(from var(--fg-light) h 20% 55%);
            --labels-dark: hsl(from var(--fg-dark) h 20% 55%);

            /* color-scheme */
            --bg: light-dark(var(--bg-light), var(--bg-dark));
            --bg2: light-dark(var(--bg-light2), var(--bg-dark2));
            --fg: light-dark(var(--fg-light), var(--fg-dark));
            --link: light-dark(var(--link-light), var(--link-dark));
            --linkh: light-dark(var(--link-light-hover), var(--link-dark-hover));
            --labels: light-dark(var(--labels-light), var(--labels-dark)); /* form labels */
            --b: light-dark(var(--input-bg-light), var(--input-bg-dark)); /* form element backgrounds */
            --bor: light-dark(var(--input-border-light), var(--input-border-dark)); /* form element shadows */
            --tint: light-dark(hsl(160, 85%, 60%), hsl(260, 85%, 60%));
            --tint2: light-dark(hsl(200, 85%, 60%), hsl(300, 85%, 60%));

            /* ease */
            --cubic: cubic-bezier(0.66, 0, 0.34, 1);
            --cubic-in: cubic-bezier(0.32, 0, 0.67, 0);
            --cubic-out: cubic-bezier(0.33, 1, 0.68, 1);
            --spring: linear(0, 0.008 1.1%, 0.034 2.3%, 0.134 4.9%, 0.264 7.3%, 0.683 14.3%, 0.797 16.5%, 0.89 18.6%, 0.967 20.7%, 1.027 22.8%, 1.073 25%, 1.104 27.3%, 1.123 30.6%, 1.119 34.3%, 1.018 49.5%, 0.988 58.6%, 0.985 65.2%, 1 84.5%, 1);

        }

        /** extra stuff **/

        body, html, #app {
            display: grid;
            min-height: 100%;
            justify-content: center;
        }

        body {
            --dot-color: light-dark(
                    hsl(from var(--bg) h s calc(l - 7) / 90%),
                    hsl(from var(--bg2) h s calc(l + 2) / 90%)
            );
            --bg-fade: light-dark(
                    var(--bg2),
                    var(--bg)
            );

            background-color: var(--bg2);
            background-image: radial-gradient(var(--dot-color) 1.25px, transparent 0px),
            linear-gradient(160deg, var(--bg), var(--bg-fade));
            background-repeat: repeat, no-repeat;
            background-size: 24px 24px, cover;
            background-position: center;
            min-width: 100svw;
            min-height: 100svh;
        }

        #app {
            display: flex;
            gap: 5vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 420px;
        }

        #app > button {
            width: max-content;
        }

        /* code {
            background: hsl( from color-mix(in oklch, var(--bg) 90%, var(--fg)) h s l / 50% );
            color: hsl( from var(--tint2) h 20% 50% );
        } */

        aside {
            opacity: 0.66;
        }


        .arrow {
            position: fixed;
            left: 50%;
            top: 30%;
            fill: white;
            color: white;
            width: 40px;
            height: 40px;
            stroke: black;
            stroke-width: 20;
            translate: 0px 0px;
            filter: invert(1) drop-shadow(0 2px 3px rgba(0, 0, 0, 0.25)) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
            animation: arrow 3.8s ease both;
            z-index: 99;
        }

        @keyframes arrow {
            0% {
                opacity: 0;
                translate: 10vw 10vh;
            }
            35%, 44% {
                scale: 1;
                translate: 1vw 10vh;
                opacity: 1;
            }
            39% {
                scale: 0.75;
                translate: 0.5vw 9.5vh;
            }
            73% {
                translate: -2vw 9vh;
                opacity: 1;
            }
            100% {
                translate: -20vw -20vh;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
<main id="app">
    <button popovertarget="contrast-popover" title="Edit contrast" type="button">
        <svg height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg">
            <g fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4">
                <path clip-rule="evenodd" d="M24 4C12.954 4 4 12.954 4 24s8.954 20 20 20z" stroke-linecap="round"/>
                <path d="M24 4c11.046 0 20 8.954 20 20s-8.954 20-20 20z"/>
                <path d="M24 36H9m15-8H5m19-8H5m19-8H9" stroke-linecap="round"/>
            </g>
        </svg>
    </button>

    <div id="contrast-popover" popover>
        <div class="contrast-buttons">
            <button id="up" type="button">
                <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 4c-.2 0-.4.1-.5.2L2.2 7.5c-.3.3-.3.8 0 1.1s.8.3 1.1 0L6 5.9l2.7 2.7c.3.3.8.3 1.1 0s.3-.8 0-1.1L6.6 4.3Q6.3 4 6 4"
                          fill="currentColor"/>
                </svg>
            </button>
            <span class="">0</span>
            <button id="down" type="button">
                <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1s.8-.3 1.1 0l2.7 2.7l2.7-2.7c.3-.3.8-.3 1.1 0s.3.8 0 1.1l-3.2 3.2q-.3.3-.6.3"
                          fill="currentColor"/>
                </svg>
            </button>
        </div>
        <div id="contrast-slider">

        </div>
    </div>

    <aside>
        <p>Based on one of the designs from <a href="https://x.com/Praha37v/status/1970410110347608489" target="_blank"><strong>@Praha37v</strong>'s
            post on Twitter</a>, with some liberties taken
            to make the design functional, and using the <code><a
                    href="https://github.com/simeydotme/svelte-range-slider-pips" target="_blank">Range Slider Pips</a></code>
            library.</p>

        <p>I've used some really nice modern features such as
            <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Popover_API/Using" target="_blank">Popover
                API</a></code>,
            <code><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_anchor_positioning/Using"
                     target="_blank">CSS anchor positioning</a></code> and
            <code><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/light-dark" target="_blank">CSS
                color-theme API</a></code>.
    </aside>

</main>

<script type="module">
    import RangeSlider from "https://esm.sh/svelte-range-slider-pips@4.0.8";

    let value = 0;
    const min = -50;
    const max = 50;

    const contrastSlider = new RangeSlider({
        target: document.getElementById("contrast-slider"),
        props: {
            value,
            vertical: true,
            pips: true,
            step: 5,
            min,
            max,
            float: false
        }
    });

    const $button = document.querySelector('button[popovertarget]');
    const $value = document.querySelector('.contrast-buttons > span')
    const $up = document.querySelector('#up')
    const $down = document.querySelector('#down')

    const updateValue = v => {
        value = v;
        setValue(v);
        contrastSlider.$set({values: [v]});
    }
    const setValue = (v) => {
        $value.innerText = v;
        const html = document.body.parentElement;
        html.style.filter = `contrast(${v / 300 + 1})`
    }
    contrastSlider.$on('change', (e) => {
        value = e.detail.value;
        setValue(value);
    });
    const increase = () => {
        value = Math.min(value + 5, max);
        updateValue(value);
    };
    const decrease = () => {
        value = Math.max(value - 5, min);
        updateValue(value);
    };


    let intervalId;
    const startFiring = (cb) => {
        intervalId = setInterval(cb, 50);
    };
    const stopFiring = () => {
        clearInterval(intervalId);
    };

    $up.addEventListener('pointerdown', () => {
        stopFiring()
        startFiring(increase);
    });
    $up.addEventListener('pointerup', () => {
        stopFiring();
    });
    $up.addEventListener('pointerleave', () => {
        stopFiring();
    });
    $down.addEventListener('pointerdown', () => {
        stopFiring()
        startFiring(decrease);
    });
    $down.addEventListener('pointerup', () => {
        stopFiring();
    });
    $down.addEventListener('pointerleave', () => {
        stopFiring();
    });


    // auto show for preview
    const $popover = document.querySelector('#contrast-popover');
    setTimeout(() => {
        $popover.showPopover();
    }, 1500);

    $popover.addEventListener("toggle", (event) => {
        if (event.newState === 'closed') {
            $button.focus();
        } else {
            const focusEvent = new FocusEvent('focus', {
                bubbles: true, // Set to true if you want the event to bubble up the DOM tree
                cancelable: false // Focus events are generally not cancelable
            });
            contrastSlider.$$.root.querySelector('.rangeHandle').focus();
        }
    })
</script>
</body>
</html>